ratioBar <- filter(cn_lineStation, carbon_measurement == 'organic')%>%
ggplot(., aes(x = lineStation, y = cn_ratio_mean))+ #, fill = carbon_measurement))+
geom_point()+
# geom_bar(stat = 'identity',
#          position = position_dodge(0.9))+
geom_errorbar(aes(ymin = cn_ratio_mean - cn_ratio_sd,
ymax = cn_ratio_mean + cn_ratio_sd),
width = 0.25,
position = position_dodge(0.9))+
scale_x_reverse()+
facet_wrap(~line)+
labs(x = 'Distance (km)',
y = bquote('Carbon to Nitrogen Ratio\n(g C '*g^-1*' N)'))+
theme_classic()
ratioBar
ratioBar <- filter(cn_lineStation, carbon_measurement == 'organic')%>%
ggplot(., aes(x = lineStation, y = cn_ratio_mean))+ #, fill = carbon_measurement))+
geom_point()+
# geom_bar(stat = 'identity',
#          position = position_dodge(0.9))+
geom_errorbar(aes(ymin = cn_ratio_mean - cn_ratio_sd,
ymax = cn_ratio_mean + cn_ratio_sd),
width = 0.25,
position = position_dodge(0.9))+
scale_x_reverse()+
facet_wrap(~line)+
labs(x = 'Distance (km)',
y = bquote('Carbon to Nitrogen Ratio (g C '*g^-1*' N)'))+
theme_classic()
ratioBar
source("~/HDProjects/ChukchiCruise23/zzz_old_versions_of_paper_analyses/ElementalAnalyzerData/src/process_with_sed_density.R", echo=TRUE)
# compare_gperg_plots <- n_gpergBar / c_gpergBar / chlBar
compare_gperg_plots <- nBar / cBar / ratioBar / chlBar
compare_gperg_plots
View(important_parts)
chlBar <- left_join(sedimentChl, select(important_parts, Station, dist_km))%>%
filter(line %in% c('HR', 'HRE'))%>%
ggplot(.,
aes(x = dist_km, y = chlmean))+
# chlBar <- ggplot(filter(sedimentChl, line %in% c('HR', 'HRE')), aes(x = lineStation, y = chlmean))+
geom_bar(stat = 'identity')+
geom_errorbar(aes(ymin = chlmean - chlsd,
ymax = chlmean + chlsd),
width = 0.25)+
scale_x_reverse()+
facet_wrap(~line)+
theme_classic()
chlBar
chlBar <- left_join(sedimentChl, select(important_parts, Station, dist_km))%>%
filter(line %in% c('HR', 'HRE'))%>%
ggplot(.,
aes(x = dist_km, y = chlmean))+
# chlBar <- ggplot(filter(sedimentChl, line %in% c('HR', 'HRE')), aes(x = lineStation, y = chlmean))+
geom_bar(stat = 'identity')+
geom_errorbar(aes(ymin = chlmean - chlsd,
ymax = chlmean + chlsd),
width = 0.25)+
scale_x_reverse()+
facet_wrap(~line)+
theme_classic()
View(sedimentChl)
chlBar <- left_join(sedimentChl, select(important_parts, line, lineStation, dist_km))%>%
filter(line %in% c('HR', 'HRE'))%>%
ggplot(.,
aes(x = dist_km, y = chlmean))+
# chlBar <- ggplot(filter(sedimentChl, line %in% c('HR', 'HRE')), aes(x = lineStation, y = chlmean))+
geom_bar(stat = 'identity')+
geom_errorbar(aes(ymin = chlmean - chlsd,
ymax = chlmean + chlsd),
width = 0.25)+
scale_x_reverse()+
facet_wrap(~line)+
theme_classic()
chlBar
chlBar <- left_join(sedimentChl, select(important_parts, line, lineStation, dist_km))%>%
filter(line %in% c('HR', 'HRE'))%>%
ggplot(.,
aes(x = dist_km, y = chlmean))+
# chlBar <- ggplot(filter(sedimentChl, line %in% c('HR', 'HRE')), aes(x = lineStation, y = chlmean))+
# geom_bar(stat = 'identity')+
geom_point()
chlBar <- left_join(sedimentChl, select(important_parts, line, lineStation, dist_km))%>%
filter(line %in% c('HR', 'HRE'))%>%
ggplot(.,
aes(x = dist_km, y = chlmean))+
# chlBar <- ggplot(filter(sedimentChl, line %in% c('HR', 'HRE')), aes(x = lineStation, y = chlmean))+
# geom_bar(stat = 'identity')+
geom_point()+
geom_errorbar(aes(ymin = chlmean - chlsd,
ymax = chlmean + chlsd),
width = 0.25)+
scale_x_reverse()+
facet_wrap(~line)+
theme_classic()
chlBar
View(important_parts)
#### Metadata ####
distances <- read.csv('../data/station_distance_key.csv')%>%
mutate(section = str_extract(section_name_full, '^.+(?=-)'))%>%
drop_na(section)%>%
group_by(section)%>%
mutate(
# dist_km = max(dist_km) - dist_km,
Station = station)%>%
ungroup()%>%
select(Station, dist_km)%>%
unique()
station_meta <- read_csv('../results/tots_station_metadata.csv')%>%
left_join(., distances)
source("~/HDProjects/ChukchiCruise23/zzz_old_versions_of_paper_analyses/ElementalAnalyzerData/src/process_with_sed_density.R", echo=TRUE)
#### Sediment Chl Data ####
sedimentChl_allLaps <- read_csv('../data/measured_chlorophyll/sediment_chl.csv')%>%
mutate(Station = as.numeric(Station))%>%
select(Station, chlMass_mg_per_m2)%>%
left_join(., station_meta)
sedimentChl <- sedimentChl_allLaps %>%
group_by(line, lineStation)%>%
summarize(chlmean = mean(chlMass_mg_per_m2, na.rm=T),
chlsd = sd(chlMass_mg_per_m2, na.rm=T))
#### Data ####
sampleMasses <- read_csv('../data/sediment_sample_masses.csv')%>%
mutate(runDate = as.numeric(runDate),
acidified = ifelse(Acidified == 'acid', T, F),
SedMass_mg = tin_subSampleMass_mg,
Station = ArrigoNumber)%>%
replace_na(list(acidified = F))
sampleDensity <- sampleMasses %>%
select(Station, replicate, mass_emptyFalcon_g, `sample_density_g/m2`)%>%
drop_na(mass_emptyFalcon_g)%>%
filter(mass_emptyFalcon_g != 'not_yet_measured')%>%
mutate(sampleDensity_g_per_m2 = as.numeric(`sample_density_g/m2`), .keep = 'unused')
eaData <- read_csv('../results/all_sediment_EA_data.csv',
col_types = cols(Sample = col_character()))%>%
mutate(c_mg = 10^-3 * c_umol * molMassC,
n_mg = 10^-3 * n_umol * molMassN,
cn_ratio = c_umol / n_umol,
runDate = as.numeric(str_extract(Run, '^\\d+')))
sampleMetadata <- sampleMasses %>%
select(runDate, Station, replicate, Sample,
acidified, arrigo_replicate_acid, carbon_measurement,
SedMass_mg)%>%
left_join(., sampleDensity)
everything <- left_join(eaData, sampleMetadata)%>%
mutate(c_gperg = c_mg / SedMass_mg,
n_gperg = n_mg / SedMass_mg,
c_gperm2 = c_gperg * sampleDensity_g_per_m2,
n_gperm2 = n_gperg * sampleDensity_g_per_m2)
important_parts <- everything %>%
select(Station, replicate, carbon_measurement, c_gperg, c_gperm2, n_gperg, n_gperm2, cn_ratio)%>%
left_join(., station_meta)
total_carbon <- important_parts %>%
filter(carbon_measurement == 'total')
organic_carbon <- important_parts %>%
filter(carbon_measurement == 'organic')
cn_lineStation <- important_parts %>%
filter(cn_ratio <= 50)%>%
drop_na(line)%>%
group_by(line, lineStation, carbon_measurement)%>%
summarize(C_mean_gperm2 = mean(c_gperm2, na.rm=T),
C_sd_gperm2 = sd(c_gperm2, na.rm=T),
N_mean_gperm2 = mean(n_gperm2, na.rm=T),
N_sd_gperm2 = sd(n_gperm2, na.rm=T),
C_mean_gperg = mean(c_gperg, na.rm=T),
C_sd_gperg = sd(c_gperg, na.rm=T),
N_mean_gperg = mean(n_gperg, na.rm=T),
N_sd_gperg = sd(n_gperg, na.rm=T),
cn_ratio_mean = mean(cn_ratio, na.rm=T),
cn_ratio_sd = sd(cn_ratio, na.rm=T),
dist_sd = sd(dist_km, na.rm = T),
dist_km = mean(dist_km, na.rm = T))
cBar <- filter(cn_lineStation, carbon_measurement == 'organic')%>%
# ggplot(., aes(x = lineStation, y = C_mean_gperm2))+ #, fill = carbon_measurement))+
ggplot(., aes(x = dist_km, y = C_mean_gperm2))+
# geom_bar(stat = 'identity',
#          position = position_dodge(0.9),
#          width = 5)+
geom_point()+
geom_errorbar(aes(ymin = C_mean_gperm2 - C_sd_gperm2,
ymax = C_mean_gperm2 + C_sd_gperm2),
width = 0.25,
position = position_dodge(0.9))+
scale_x_reverse()+
facet_wrap(~line)+
labs(x = 'Distance (km)',
y = bquote('Sediment Organic Carbon ('*g~m^-2*')'))+
theme_classic()
cBar
nBar <- filter(cn_lineStation, carbon_measurement == 'organic')%>%
# nBar <- cn_lineStation%>%
# ggplot(., aes(x = lineStation, y = N_mean_gperm2))+ #, fill = carbon_measurement))+
ggplot(., aes(x = dist_km, y = N_mean_gperm2))+
geom_point()+
# geom_bar(stat = 'identity',
#          position = position_dodge(0.9),
#          width = 10)+
geom_errorbar(aes(ymin = N_mean_gperm2 - N_sd_gperm2,
ymax = N_mean_gperm2 + N_sd_gperm2),
width = 0.25,
position = position_dodge(0.9))+
scale_x_reverse()+
facet_wrap(~line)+
labs(x = 'Distance (km)',
y = bquote('Sediment Nitrogen ('*g~m^-2*')'))+
theme_classic()
nBar
ratioBar <- filter(cn_lineStation, carbon_measurement == 'organic')%>%
ggplot(., aes(x = lineStation, y = cn_ratio_mean))+ #, fill = carbon_measurement))+
geom_point()+
# geom_bar(stat = 'identity',
#          position = position_dodge(0.9))+
geom_errorbar(aes(ymin = cn_ratio_mean - cn_ratio_sd,
ymax = cn_ratio_mean + cn_ratio_sd),
width = 0.25,
position = position_dodge(0.9))+
scale_x_reverse()+
facet_wrap(~line)+
labs(x = 'Distance (km)',
y = bquote('Carbon to Nitrogen Ratio (g C '*g^-1*' N)'))+
theme_classic()
ratioBar
c_gpergBar <- ggplot(cn_lineStation, aes(x = lineStation,
y = C_mean_gperg,
fill = carbon_measurement))+
geom_bar(stat = 'identity',
position = position_dodge(0.9))+
geom_errorbar(aes(ymin = C_mean_gperg - C_sd_gperg,
ymax = C_mean_gperg + C_sd_gperg),
width = 0.25,
position = position_dodge(0.9))+
scale_x_reverse()+
facet_wrap(~line)+
theme_classic()
c_gpergBar
n_gpergBar <- ggplot(cn_lineStation, aes(x = lineStation, y = N_mean_gperg, fill = carbon_measurement))+
geom_bar(stat = 'identity',
position = position_dodge(0.9))+
geom_errorbar(aes(ymin = N_mean_gperg - N_sd_gperg,
ymax = N_mean_gperg + N_sd_gperg),
width = 0.25,
position = position_dodge(0.9))+
scale_x_reverse()+
facet_wrap(~line)+
theme_classic()
n_gpergBar
chlBar <- left_join(sedimentChl, select(important_parts, line, lineStation, dist_km))%>%
filter(line %in% c('HR', 'HRE'))%>%
ggplot(.,
aes(x = dist_km, y = chlmean))+
# chlBar <- ggplot(filter(sedimentChl, line %in% c('HR', 'HRE')), aes(x = lineStation, y = chlmean))+
# geom_bar(stat = 'identity')+
geom_point()+
geom_errorbar(aes(ymin = chlmean - chlsd,
ymax = chlmean + chlsd),
width = 0.25)+
scale_x_reverse()+
facet_wrap(~line)+
theme_classic()
chlBar
compare_gperm2_plots <- nBar / cBar / chlBar
compare_gperm2_plots
# compare_gperg_plots <- n_gpergBar / c_gpergBar / chlBar
compare_gperg_plots <- nBar / cBar / ratioBar
compare_gperg_plots
ratioBar <- filter(cn_lineStation, carbon_measurement == 'organic')%>%
ggplot(., aes(x = dist_km, y = cn_ratio_mean))+ #, fill = carbon_measurement))+
geom_point()+
# geom_bar(stat = 'identity',
#          position = position_dodge(0.9))+
geom_errorbar(aes(ymin = cn_ratio_mean - cn_ratio_sd,
ymax = cn_ratio_mean + cn_ratio_sd),
width = 0.25,
position = position_dodge(0.9))+
scale_x_reverse()+
facet_wrap(~line)+
labs(x = 'Distance (km)',
y = bquote('Carbon to Nitrogen Ratio (g C '*g^-1*' N)'))+
theme_classic()
ratioBar
c_gpergBar <- ggplot(cn_lineStation, aes(x = lineStation,
y = C_mean_gperg,
fill = carbon_measurement))+
geom_bar(stat = 'identity',
position = position_dodge(0.9))+
geom_errorbar(aes(ymin = C_mean_gperg - C_sd_gperg,
ymax = C_mean_gperg + C_sd_gperg),
width = 0.25,
position = position_dodge(0.9))+
scale_x_reverse()+
facet_wrap(~line)+
theme_classic()
c_gpergBar
n_gpergBar <- ggplot(cn_lineStation, aes(x = lineStation, y = N_mean_gperg, fill = carbon_measurement))+
geom_bar(stat = 'identity',
position = position_dodge(0.9))+
geom_errorbar(aes(ymin = N_mean_gperg - N_sd_gperg,
ymax = N_mean_gperg + N_sd_gperg),
width = 0.25,
position = position_dodge(0.9))+
scale_x_reverse()+
facet_wrap(~line)+
theme_classic()
n_gpergBar
chlBar <- left_join(sedimentChl, select(important_parts, line, lineStation, dist_km))%>%
filter(line %in% c('HR', 'HRE'))%>%
ggplot(.,
aes(x = dist_km, y = chlmean))+
# chlBar <- ggplot(filter(sedimentChl, line %in% c('HR', 'HRE')), aes(x = lineStation, y = chlmean))+
# geom_bar(stat = 'identity')+
geom_point()+
geom_errorbar(aes(ymin = chlmean - chlsd,
ymax = chlmean + chlsd),
width = 0.25)+
scale_x_reverse()+
facet_wrap(~line)+
theme_classic()
chlBar
compare_gperm2_plots <- nBar / cBar / chlBar
compare_gperm2_plots
# compare_gperg_plots <- n_gpergBar / c_gpergBar / chlBar
compare_gperg_plots <- nBar / cBar / ratioBar
compare_gperg_plots
getwd()
source("~/HDProjects/ChukchiCruise23/code/data_for_publication/supplementary_figure_3/src/process_with_sed_density.R", echo = TRUE)
source("~/HDProjects/ChukchiCruise23/code/data_for_publication/supplementary_figure_3/src/process_with_sed_density.R", echo = TRUE)
setwd("~/HDProjects/ChukchiCruise23/code/data_for_publication/fig8_supplementary1_Ecotaxa/src")
source("~/HDProjects/ChukchiCruise23/code/data_for_publication/fig8_supplementary1_Ecotaxa/src/hierarchical_stacked_bar_chart_figure6.R", echo = TRUE)
source("~/HDProjects/ChukchiCruise23/code/data_for_publication/fig8_supplementary1_Ecotaxa/src/ecotaxa_nmds_traps_only_supplementary1.R", echo = TRUE)
#### Read in STACANI and Other Metadata ####
iceObserved <- read_csv('../../data_directory/metadata/observed_ice_edge_bridgecam_updated072425.csv')%>%
mutate(ice_class = ice_obs)%>%
select(station, ice_class)%>%
mutate(ice_class = ifelse(station == 29, 'miz', ice_class))
stacani_trap <- read_csv('../data/trap_stacani.csv')%>%
mutate(sample_id = Sample_Number,
deployment = Deployment,
depth = Trap_Depth,
depthCat = ifelse(Trap_Depth < 5, 'ice',
ifelse(Trap_Depth < 20, 'shallow', 'deep')),
station_deploy = Deploy_Station,
station_recover = Recover_Station,
station = station_deploy,
# # Uncomment for recovery-focused STACANI. Metadata currently coming from deploy station
# station = station_recover,
.keep = 'none') %>%
# select(sample_id, deployment, station_deploy, station_recover, station, Deploy_Type, Trap_Depth, depthCat)%>%
left_join(., iceObserved)
source("~/HDProjects/ChukchiCruise23/code/data_for_publication/fig8_supplementary1_Ecotaxa/src/ecotaxa_nmds_traps_only_supplementary1.R", echo = TRUE)
#### Hierarchical Data ####
trap <- read_csv('../../data_directory/taxonomy/trap_ecotaxa_export_with_biovolume_threshold97_method.csv')%>%
left_join(., stacani_trap)%>%
mutate(
sample_id = as.character(sample_id),
sample_type = 'trap',
unique_id = paste(deployment, depthCat, 'trap', depth, sep = '_'),
nmds_group = paste(ice_class, 'trap', sep = '_'))%>%
mutate(
object_annotation_hierarchy = case_when(
## Large Diatom Group Fixes ##
object_annotation_hierarchy == "living>Eukaryota>Diatoms>diatom long+chained" ~
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom Chain Long",
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom Chain Long>Unclassified Diatom Chain Long>Unclassified Diatom Chain Long>Unclassified Diatom Chain Long",
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom>Unclassified Diatom>Unclassified Diatom>Unclassified Diatom",
object_annotation_hierarchy == "living>pennate diatom" ~
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Pennate Diatom",
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Pennate Diatom>Unclassified Pennate Diatom>Unclassified Pennate Diatom>Unclassified Pennate Diatom",
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom Pennate>Unclassified Diatom Pennate>Unclassified Diatom Pennate>Unclassified Diatom Pennate",
## Diatom Temp Group Fixes ##
str_detect(object_annotation_hierarchy, "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>pennate>pennate [1-5] temp") ~
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Pennate Diatom Single",
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Pennate Diatom>Unclassified Pennate Diatom>Unclassified Pennate Diatom>Unclassified Pennate Diatom",
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom Pennate>Unclassified Diatom Pennate>Unclassified Diatom Pennate>Unclassified Diatom Pennate",
str_detect(object_annotation_hierarchy, "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>pennate>pennate [6-9] temp") ~
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Pennate Diatom Chain",
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Pennate Diatom>Unclassified Pennate Diatom>Unclassified Pennate Diatom>Unclassified Pennate Diatom",
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom Pennate>Unclassified Diatom Pennate>Unclassified Diatom Pennate>Unclassified Diatom Pennate",
str_detect(object_annotation_hierarchy, "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>centric>centric [1-2] temp") ~
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Centric Diatom Chain",
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Centric Diatom>Unclassified Centric Diatom>Unclassified Centric Diatom>Unclassified Centric Diatom",
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom Centric>Unclassified Diatom Centric>Unclassified Diatom Centric>Unclassified Diatom Centric",
## Dinoflagellates and Cilliates
object_annotation_hierarchy == "living>Eukaryota>Dinoflagellates" ~
# "living>Eukaryota>Harosa>Alveolata>Myzoza>Dinoflagellata",
"living>Eukaryota>Harosa>Alveolata>Myzoza>Dinoflagellata>Unclassified Dynoflagellate>Unclassified Dynoflagellate>Unclassified Dynoflagellate>Unclassified Dynoflagellate",
object_annotation_hierarchy == "living>Eukaryota>Harosa>Alveolata>Ciliophora>ciliate-other" ~
# "living>Eukaryota>Harosa>Alveolata>Ciliophora",
"living>Eukaryota>Harosa>Alveolata>Ciliophora>Unclassified Ciliate>Unclassified Ciliate>Unclassified Ciliate>Unclassified Ciliate>Unclassified Ciliate",
## Species Level Fixes ##
object_annotation_hierarchy == "living>temporary>Fragilariopsis oceanica" ~
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Bacillariophytina>Bacillariophyceae>Fragilariopsis>Fragilariopsis oceanica",
object_annotation_hierarchy == "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Bacillariophytina>Bacillariophyceae>Navicula>Navicula sp." ~
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Bacillariophytina>Bacillariophyceae>Navicula",
## Not Living ##
object_annotation_hierarchy == "not-living>detritus" ~
"not living>Detritus>Detritus>Detritus>Detritus>Detritus>Detritus>Detritus>Detritus>Detritus",
TRUE ~ object_annotation_hierarchy  # keep all other values unchanged
)
)%>%
separate(
col = object_annotation_hierarchy,
into = c("liveCell", "domain", "supergroup", "phylum_group", "phylum",
"clade", "subphylum", "class", "genus", 'species'), # (10)
sep = ">",
fill = "right",
remove = FALSE
) %>%
mutate(
across(liveCell:species, ~ replace_na(.x, "Unclassified")),
# genus = ifelse(clade == 'Bacillariophyta', paste(genus, '(Diatom)'), genus)
)%>%
filter(
object_annotation_category != 'transparent',
object_annotation_category != 'bubble')%>%
group_by(unique_id, sample_type, ice_class, depthCat, nmds_group, genus)%>% #general_annotation_category)%>%
summarise(count = n(),
biovolume = sum(biovolume_mL_L))%>%
ungroup()
data <- trap %>%
# filter(general_annotation_category != 'bubble',
#        # general_annotation_category != 'detritus',
#        # general_annotation_category != 'unidentified cells',
#        general_annotation_category != 'transparent')%>%
group_by(unique_id)%>%
mutate(totalBV = sum(biovolume),
relative_biovolume = biovolume / totalBV)%>%
ungroup()%>%
select(-totalBV)
#### Hierarchical Data ####
trap <- read_csv('../../data_directory/taxonomy/trap_ecotaxa_export_with_biovolume_threshold97_method.csv')%>%
left_join(., stacani_trap)%>%
mutate(
sample_id = as.character(sample_id),
sample_type = 'trap',
unique_id = paste(deployment, depthCat, 'trap', depth, sep = '_'),
nmds_group = paste(ice_class, 'trap', sep = '_'))%>%
mutate(
object_annotation_hierarchy = case_when(
## Large Diatom Group Fixes ##
object_annotation_hierarchy == "living>Eukaryota>Diatoms>diatom long+chained" ~
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom Chain Long",
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom Chain Long>Unclassified Diatom Chain Long>Unclassified Diatom Chain Long>Unclassified Diatom Chain Long",
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom>Unclassified Diatom>Unclassified Diatom>Unclassified Diatom",
object_annotation_hierarchy == "living>pennate diatom" ~
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Pennate Diatom",
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Pennate Diatom>Unclassified Pennate Diatom>Unclassified Pennate Diatom>Unclassified Pennate Diatom",
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom Pennate>Unclassified Diatom Pennate>Unclassified Diatom Pennate>Unclassified Diatom Pennate",
## Diatom Temp Group Fixes ##
str_detect(object_annotation_hierarchy, "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>pennate>pennate [1-5] temp") ~
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Pennate Diatom Single",
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Pennate Diatom>Unclassified Pennate Diatom>Unclassified Pennate Diatom>Unclassified Pennate Diatom",
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom Pennate>Unclassified Diatom Pennate>Unclassified Diatom Pennate>Unclassified Diatom Pennate",
str_detect(object_annotation_hierarchy, "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>pennate>pennate [6-9] temp") ~
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Pennate Diatom Chain",
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Pennate Diatom>Unclassified Pennate Diatom>Unclassified Pennate Diatom>Unclassified Pennate Diatom",
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom Pennate>Unclassified Diatom Pennate>Unclassified Diatom Pennate>Unclassified Diatom Pennate",
str_detect(object_annotation_hierarchy, "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>centric>centric [1-2] temp") ~
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Centric Diatom Chain",
# "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Centric Diatom>Unclassified Centric Diatom>Unclassified Centric Diatom>Unclassified Centric Diatom",
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Unclassified Diatom Centric>Unclassified Diatom Centric>Unclassified Diatom Centric>Unclassified Diatom Centric",
## Dinoflagellates and Cilliates
object_annotation_hierarchy == "living>Eukaryota>Dinoflagellates" ~
# "living>Eukaryota>Harosa>Alveolata>Myzoza>Dinoflagellata",
"living>Eukaryota>Harosa>Alveolata>Myzoza>Dinoflagellata>Unclassified Dynoflagellate>Unclassified Dynoflagellate>Unclassified Dynoflagellate>Unclassified Dynoflagellate",
object_annotation_hierarchy == "living>Eukaryota>Harosa>Alveolata>Ciliophora>ciliate-other" ~
# "living>Eukaryota>Harosa>Alveolata>Ciliophora",
"living>Eukaryota>Harosa>Alveolata>Ciliophora>Unclassified Ciliate>Unclassified Ciliate>Unclassified Ciliate>Unclassified Ciliate>Unclassified Ciliate",
## Species Level Fixes ##
object_annotation_hierarchy == "living>temporary>Fragilariopsis oceanica" ~
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Bacillariophytina>Bacillariophyceae>Fragilariopsis>Fragilariopsis oceanica",
object_annotation_hierarchy == "living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Bacillariophytina>Bacillariophyceae>Navicula>Navicula sp." ~
"living>Eukaryota>Harosa>Stramenopiles>Ochrophyta>Bacillariophyta>Bacillariophytina>Bacillariophyceae>Navicula",
## Not Living ##
object_annotation_hierarchy == "not-living>detritus" ~
"not living>Detritus>Detritus>Detritus>Detritus>Detritus>Detritus>Detritus>Detritus>Detritus",
TRUE ~ object_annotation_hierarchy  # keep all other values unchanged
)
)%>%
separate(
col = object_annotation_hierarchy,
into = c("liveCell", "domain", "supergroup", "phylum_group", "phylum",
"clade", "subphylum", "class", "genus", 'species'), # (10)
sep = ">",
fill = "right",
remove = FALSE
) %>%
mutate(
across(liveCell:species, ~ replace_na(.x, "Unclassified")),
)%>%
filter(
object_annotation_category != 'transparent',
object_annotation_category != 'bubble')%>%
group_by(unique_id, sample_type, ice_class, depthCat, nmds_group, genus)%>% #general_annotation_category)%>%
summarise(count = n(),
biovolume = sum(biovolume_mL_L))%>%
ungroup()
data <- trap %>%
group_by(unique_id)%>%
mutate(totalBV = sum(biovolume),
relative_biovolume = biovolume / totalBV)%>%
ungroup()%>%
select(-totalBV)
grouping_vars <- data %>%
select(unique_id, sample_type, ice_class, depthCat, nmds_group)%>%
mutate(depthCat = factor(depthCat, levels = c('core', 'ice', '1-5', '5-10', '10+', 'shallow', 'deep')))%>%
distinct()
source("~/HDProjects/ChukchiCruise23/code/data_for_publication/fig8_supplementary1_Ecotaxa/src/ecotaxa_nmds_traps_only_supplementary1.R", echo = TRUE)
#### Read in STACANI and Other Metadata ####
iceObserved <- read_csv('../../data_directory/metadata/observed_ice_edge_bridgecam_updated072425.csv')%>%
mutate(ice_class = ice_obs)%>%
select(station, ice_class)%>%
mutate(ice_class = ifelse(station == 29, 'miz', ice_class))
source("~/HDProjects/ChukchiCruise23/code/data_for_publication/fig8_supplementary1_Ecotaxa/src/hierarchical_stacked_bar_chart_figure6.R", echo = TRUE)
source("~/HDProjects/ChukchiCruise23/code/data_for_publication/fig8_supplementary1_Ecotaxa/src/hierarchical_stacked_bar_chart_figure6.R", echo = TRUE)
